record(bo, "$(P)$(R)ToggleGripper") {
    field(ZNAM, "Open")
    field(ONAM, "Close")
    field(FLNK, "$(P)$(R)try_run_toggle_gripper.PROC")
}

record(calcout, "$(P)$(R)try_run_toggle_gripper") {
    field(INPA, "$(P)$(R)ToggleGripper:Running.VAL")
    field(CALC, "A")
    field(DOPT, "Use OCAL")
    field(OCAL, "1")
    field(OOPT, "When Zero")
    field(OUT, "$(P)$(R)run_toggle_gripper.PROC")
}

record(fanout, "$(P)$(R)run_toggle_gripper") {
    field(LNK0, "$(P)$(R)ToggleGripper:set_post_url.PROC")
    field(LNK1, "$(P)$(R)ToggleGripper:enable_status_scan.PROC")
}

record(luascript, "$(P)$(R)ToggleGripper:set_post_url") {
    field(INPA, "$(P)$(R)ToggleGripper.VAL")
    field(CODE, "@ur_module.lua toggle_gripper_set_post_url({prefix='$(P)',host='$(HOST)'})")
    field(SYNC, "Sync")
    field(OUT, "$(P)$(RQ1)URL.VAL$ PP")
    field(FLNK, "$(P)$(RQ1)Post.PROC")
}

record(lsi, "$(P)$(R)ToggleGripper:ActionID") {
    field(INP, "$(P)$(RQ1)JSONParserValue.VAL$ CP")
    field(FLNK, "$(P)$(R)ToggleGripper:set_get_url.PROC")
}

record(luascript, "$(P)$(R)ToggleGripper:set_get_url") {
    field(INAA, "$(P)$(R)ToggleGripper:ActionID.VAL$")
    field(CODE, "@ur_module.lua toggle_gripper_set_get_url({prefix='$(P)',host='$(HOST)'})")
    field(SYNC, "Sync")
    field(OUT, "$(P)$(RQ2)URL.VAL$ PP")
    field(FLNK, "$(P)$(RQ2)Get.PROC")
}

record(luascript, "$(P)$(R)ToggleGripper:check_running") {
    field(INAA, "$(P)$(RQ2)JSONParserValue.VAL$ NPP")
    field(CODE, "table.concat(AA)=='running' and 1 or 0")
    field(FLNK, "$(P)$(RQ2)Execute.PROC")
}

record(bi, "$(P)$(R)ToggleGripper:Running") {
    field(INP, "$(P)$(R)ToggleGripper:check_running.VAL CP")
    field(ZNAM, "Done")
    field(ONAM, "Running")
}

record(longout, "$(P)$(R)ToggleGripper:enable_status_scan") {
    field(VAL, "9") 
    field(OUT, "$(P)$(R)ToggleGripper:check_running.SCAN PP")
}

record(calcout, "$(P)$(R)ToggleGripper:disable_status_scan") {
    field(INPA, "$(P)$(R)ToggleGripper:check_running.VAL CP")
    field(CALC, "A")
    field(OCAL, "0")
    field(DOPT, "Use OCAL")
    field(OOPT, "Transition To Zero")
    field(OUT, "$(P)$(R)ToggleGripper:check_running.SCAN PP")
}
